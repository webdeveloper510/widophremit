{% extends 'mophy/elements/layouts/admin.html' %}

{% load static %}

{% block additional_css %}
{% endblock %}

{% block content %}
<link rel="icon" type="image/png" sizes="16x16" href="/static/mophy/images/footer-logo.svg" />   
<link rel="stylesheet" href="/static/mophy/vendor/jqvmap/css/jqvmap.min.css" >
<link rel="stylesheet" href="/static/mophy/vendor/chartist/css/chartist.min.css" >
<link rel="stylesheet" href="/static/mophy/vendor/datatables/css/jquery.dataTables.min.css" >
<link rel="stylesheet" href="/static/mophy/vendor/bootstrap-select/dist/css/bootstrap-select.min.css">
<link rel="stylesheet" href="/static/mophy/css/style.css">

<div class="card corridore_card">
    <div class="card-body">
        <div class="row">
            <div class="col-10">
                <ul class="transaction-detail-row">
                    <li>
                    <img src="/static/mophy/images/payout1.png" />  Account Name - <label> {{data.account_name}}</label>
                    </li>
                    <li>
                        <img src="/static/mophy/images/payout2.png" />  Last Edited Date - <label> {{data.updated_at.date}}</label>
                    </li>
                    <li>
                        <img src="/static/mophy/images/payout3.png" />  Balance - <label> AUD {{balance}}</label>
                    </li>
                </ul>
            </div>

            <div class="col-auto mt-2 d-flex justify-content-start">
                <ol class="breadcrumb">
                    <li class="breadcrumb-item">
                        <a class="text-black fw-bold payout-list-back" href="{% url 'mophy:confirm-details' %}">
                            <u>Back</u>
                        </a>
                    </li>
                </ol>
            </div>
            
        </div>
    </div>

</div>

<div class="row">
    <div class="col-xl-6">
        <div class="card corridore_card">
          <div class="card-header">
              <h4 class="fw-bold mb-0">Personal Details </h4>
          </div>
          <div class="card-body">
            <div class="table-responsive table-hover fs-14 card-table">
              <table class="table display mb-4 dataTablesCard user_details">
                <tbody>
                    <tr>
                        <td  class="text-black font-w600 mb-0">User ID</td>
                        {% if data.zai_user_id %}
                            <td><span class="text-black text-nowrap">{{data.zai_user_id}}</span></td>
                        {% else %}
                            <td><span class="text-black text-nowrap">None</span></td>
                        {% endif %}
                    </tr>
                  <tr>
                  <td  class="text-black font-w600 mb-0">First Name</td>
                  {% if data.first_name %}
                      <td><span class="text-black text-nowrap">{{data.first_name}}</span></td>
                  {% else %}
                      <td><span class="text-black text-nowrap">None</span></td>
                  {% endif %}
                  </tr>
                  <tr>
                      <td  class="text-black font-w600 mb-0">Last Name</td>
                      {% if data.last_name %}
                          <td><span class="text-black text-nowrap">{{data.last_name}}</span></td>
                      {% else %}
                          <td><span class="text-black text-nowrap">None</span></td>
                      {% endif %}
                  </tr>
                  <tr>
                      <td  class="text-black font-w600 mb-0">Nick Name</td>
                      {% if data.nick_name %}
                          <td><span class="text-black text-nowrap">{{data.nick_name}}</span></td>
                      {% else %}
                          <td><span class="text-black text-nowrap">None</span></td>
                      {% endif %}
                  </tr>
                  <tr>
                      <td  class="text-black font-w600 mb-0">Email</td>
                      {% if data.zai_email %}
                          <td><span class="text-black text-nowrap">{{data.zai_email}}</span></td>
                      {% else %}
                          <td><span class="text-black text-nowrap">None</span></td>
                      {% endif %}
                  </tr>                 
                </tbody>
              </table>
            </div>
          </div>
        </div>
    </div>

    <div class="col-xl-6">
        <div class="card corridore_card">
          <div class="card-header">
              <h4 class="fw-bold mb-0">Bank Details </h4>
          </div>
          <div class="card-body">
            <div class="table-responsive table-hover fs-14 card-table">
              <table class="table display mb-4 dataTablesCard user_details">
                <tbody>
                    <tr>
                        <td  class="text-black font-w600 mb-0">Bank Name</td>
                        {% if data.bank_name %}
                            <td><span class="text-black text-nowrap">{{data.bank_name}}</span></td>
                        {% else %}
                            <td><span class="text-black text-nowrap">None</span></td>
                        {% endif %}
                    </tr>
                  <tr>
                  <td  class="text-black font-w600 mb-0">Account Name</td>
                  {% if data.account_name %}
                      <td><span class="text-black text-nowrap">{{data.account_name}}</span></td>
                  {% else %}
                      <td><span class="text-black text-nowrap">None</span></td>
                  {% endif %}
                  </tr>
                  <tr>
                      <td  class="text-black font-w600 mb-0">Account Number</td>
                      {% if data.account_number %}
                          <td><span class="text-black text-nowrap">{{data.account_number}}</span></td>
                      {% else %}
                          <td><span class="text-black text-nowrap">None</span></td>
                      {% endif %}
                  </tr>
                  <tr>
                      <td  class="text-black font-w600 mb-0">Routing / BSB Number</td>
                      {% if data.routing_number %}
                          <td><span class="text-black text-nowrap">{{data.routing_number}}</span></td>
                      {% else %}
                          <td><span class="text-black text-nowrap">None</span></td>
                      {% endif %}
                  </tr>            
                </tbody>
              </table>
            </div>
          </div>
        </div>
    </div>
</div>

<div class="card corridore_card">
    <div class="card-header">
        <h4 class="card-title">Transaction List</h4>
        <!-- <ol class="breadcrumb">
            <li class="breadcrumb-item ">
                <a class="text-black fw-bold payout-list-back" href="{% url 'mophy:confirm-details' %}" ><u >Back</u></a>
            </li>
        </ol> -->
    </div>
 <div class="card-body">
  <div class="row newlayout-table">
    <div class="col-lg-12">
     
     <div class="table-hover fs-14 card-table customer-table-row" id="custom-search3" style="position: relative;">    
        <table class="table dataTablesCard style-1 custom-tbl card-table previous-transactions display" id="example22" style="width: 100% !important;">
            <thead>
                <tr>       
                    <th>S/N</th>
                    <th>Date</th>
                    <th>Source ID</th>
                    <th>Destination ID</th>
                    <th>Destination Bank</th>
                    <th>Amount</th>
                    <th>Status</th>
                </tr>
            </thead>
            <tbody>               
                {% for t in transactions %}
                <tr class="data-row">
                    <td><a href="#"><span class="text-black font-w400 mb-0"> {{forloop.counter}}</span></a></td>
                    <td><a href="#"><span class="text-black font-w400 mb-0">{{t.date}}</span></a></td>
                    <td><a href="#"><span class="text-black font-w400 mb-0">{{t.source_id}}</span></a></td>
                    <td><a href="#"><span class="text-black font-w400 mb-0">{{t.receiver_id}}</span></a></td>
                    <td><a href="#"><span class="text-black font-w400 mb-0 text-capitalize">{{t.destination_id}}</span></a></td>
                    <td><a href="#"><span class="text-black font-w400 mb-0">AUD {{t.amount}}</span></a></td>
                    <td><a href="#"><span class="text-black font-w400 mb-0">{{t.status}}</span></a></td>                  
                </tr>
                {% endfor %}
            </tbody>
        </table>
     </div>
    </div>
  </div>
 </div>
</div>



<p id="old_csv_value" value="" style="display: none;"></p>



<!-- payout confirmation Modal Start -->
<div class="modal fade" id="delete-confirmation">
    <div class="modal-dialog modal-dialog-centered modal-md" role="document">
        <div class="modal-content">
            <div class="modal-header">
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="align-items-center text-center">
                <img src="/static/mophy/images/deletedata.png">
            </div>
                <h5 class="mt-4 text-center">ARE YOU SURE YOU WANT TO DELETE THIS ACCOUNT?</h5>

            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-primary style-button" data-bs-dismiss="modal">Done</button>

                <button type="button" class="btn btn-primary style-button" data-bs-dismiss="modal">Cancel</button>
        </div>
        </div>
    </div>
</div>

{% endblock %}

{% block additional_js %}
<script src="https://cdn.datatables.net/1.13.6/js/jquery.dataTables.min.js"></script>

<script>
    $(document).ready(function() {
        new DataTable('#example22', {
            scrollX: true,
            scrollCollapse: true,
            scrollY: '530px',
            pageLength: 20,
            fixedHeader: true,
            lengthChange: false,
            responsive: true,
            order: [], // Disable initial sorting
            // columnDefs: [{
            //     targets: '_all', 
            //     orderable: true,
            //     orderData: [3], // Set the order data (adjust index as needed)
            //     orderSequence: ['desc', 'asc'] // Set the order sequence for sorting
            // }]
        });
    });
</script>


<style>
    .dataTables_scrollHeadInner{
        width: 100% !important;
    }
    table.table.dataTablesCard.style-1.custom-tbl.card-table.previous-transactions.display.dataTable.no-footerÂ {
        width: 100% !important;
    }
    table.table.dataTablesCard.style-1.custom-tbl.card-table.previous-transactions.display.dataTable.no-footer {
        width: 100% !important;
    }
</style>

<script>
    function get_csv_filter_values(){
        var key = $('#csv_key').val();
        var old_csv_value = $('#old_csv_value').val();

        $.ajax({
            type: "POST",
            url: "{% url 'mophy:get-csv-values' %}",
            data: {csv_key:key, type:"transaction", csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (data) {
                if(data.success){
                    data = data.csv_values
                    $('#csv_value').html('');
                    $('#csv_value').append($('<option>').text('Choose Value ..').prop('disabled', true).prop('selected', true));
                    for (var i = 0; i < data.length; i++) {
                        $('#csv_value').append($('<option>').text(data[i]).attr('value', data[i]));
                }
                var get_value = '{{ value }}';
                if (get_value !== 'None' && get_value !== old_csv_value) {
                    $('#csv_value').val(get_value);
                }
                $('#old_csv_value').val(get_value);
            }

            }            
        })
    }
    function set_value(){
    
        var key = $('#csv_value').val();
        $.ajax({
            type: "POST",
            url: "{% url 'mophy:set-value' %}",
            data: {key, type:"transaction", csrfmiddlewaretoken: '{{ csrf_token }}'},
            success: function (data) {
              window.location.reload();
            }            
        })
    }

    function getFilterList(){
        var filter_value = '{{ filter_value }}';
        var get_value = '{{ value }}';
        console.log(filter_value,get_value);
        if(filter_value=='None' || get_value=='None' || filter_value=='' || get_value==''){

        }
        else{
          
            $('#csv_key').val(filter_value);
            $('#csv_value').val(get_value);

             get_csv_filter_values();
           
             
           
        }
    

    }
    getFilterList();
</script>

<script>
    function download_csv(){
        var key = $('#csv_key').val();
        var value = $('#csv_value').val();
        var error_flag = false

        
        if (key === null && value === null){
            error_flag = false
            key = "null"
            value = "null"
        }
        else{        
            if (key === null){
                $("#csv_key").addClass("is-invalid");
                event.preventDefault(); 
                error_flag = true
            }
            if (value === 'None'){
                $("#csv_value").addClass("is-invalid");
                event.preventDefault(); 
                error_flag = true
            }
        }
        if (error_flag === false){
            $("#csv_key").removeClass("is-invalid");
            $("#csv_value").removeClass("is-invalid");
            $.ajax({
                type: "POST",
                url: "{% url 'mophy:download-csv' %}",
                data: {csv_key:key, csv_value:value, type:"transaction", csrfmiddlewaretoken: '{{ csrf_token }}'},
                success: function (data) {
                    if(data.success){
                        window.open("{% url 'mophy:download-csv' %}")
                    }
                }                      
            })
        }
    }
</script>
{% endblock %}


